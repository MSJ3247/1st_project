<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>리뷰 게시판 - VertScreen</title>
  <link rel="stylesheet" href="../assets/css/VertScreen_mainStyle.css">
  <style>
    main {
      max-width: 800px;
      margin: 40px auto;
      padding: 0 20px;
    }

    h1 {
      font-size: 2rem;
      font-weight: 900;
      margin-bottom: 30px;
    }

    /* 리뷰 목록 */
    .review-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 30px;
    }

    .review-item {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      padding: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.25s ease;
    }

    .review-item:hover {
      border-color: var(--accent);
      background: rgba(29, 161, 242, 0.1);
    }

    /* 페이지네이션 */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
    }

    .pagination button {
      padding: 6px 12px;
      border: 1px solid var(--line);
      border-radius: 8px;
      background: var(--panel);
      color: var(--text);
      cursor: pointer;
    }

    .pagination button.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }

    /* 검색바 */
    .search-bar {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .search-bar input[type="text"] {
      flex: 1;
      padding: 10px 14px;
      border-radius: var(--radius);
      border: 1px solid var(--line);
      background: var(--panel);
      color: var(--text);
    }

    /* 프로필 드롭다운 */
    .profile {
      position: relative;
      display: none;
      align-items: center;
      cursor: pointer;
    }

    .avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      color: #000;
    }

    .dropdown {
      display: none;
      position: absolute;
      top: 48px;
      right: 0;
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      overflow: hidden;
      min-width: 140px;
      box-shadow: var(--shadow);
    }

    .dropdown a,
    .dropdown button {
      display: block;
      width: 100%;
      padding: 12px;
      background: none;
      border: none;
      color: var(--text);
      text-align: left;
      cursor: pointer;
      font-size: 14px;
    }

    .dropdown a:hover,
    .dropdown button:hover {
      background: #22314b;
    }
  </style>
</head>

<body>
  <header class="site-header">
    <div class="nav-wrap">
      <div class="brand">
        <a href="../vertscreen_main.html">
          <img src="../VertScreen_logo.png" alt="VertScreen Logo">
        </a>
      </div>
      <nav class="nav">
        <a href="../views/vertscreen_advertlist.html">광고 종류</a>
        <a href="../views/vertscreen_brand.html">브랜드 가치</a>
        <a href="../views/party/party-board.html">파티 모집</a>
        <a href="../views/advertisement/listTest.html">광고 제안</a>
        <a href="../views/review.html" id="reviewLink">리뷰 게시판</a>
      </nav>
      <div class="spacer"></div>
      <div class="actions" id="authArea">
        <a href="../views/member/login.html" class="btn">로그인</a>
        <a href="/views/member/login.html?mode=signup" class="btn primary">회원가입</a>
      </div>
      <div class="profile" id="profile">
        <div class="avatar" id="avatar">U</div>
        <div class="dropdown" id="dropdown">
          <div style="padding:12px;color:var(--muted)" id="welcomeMsg">사용자님 환영합니다!</div>
          <a href="../views/member/myPage.html">마이페이지</a>
          <button onclick="logout()">로그아웃</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <h1>리뷰 게시판</h1>

    <!-- 리뷰 목록 -->
    <div class="review-list" id="reviewList"></div>

    <!-- 페이지네이션 -->
    <div class="pagination">
      <button>&laquo;</button>
      <button class="active">1</button>
      <button>2</button>
      <button>3</button>
      <button>4</button>
      <button>5</button>
      <button>&raquo;</button>
    </div>

    <!-- 검색바 -->
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="리뷰 내용 또는 파티명을 검색하세요">
    </div>

    <!-- 리뷰 작성 버튼
    <div class="write-review">
      <button onclick="alert('리뷰 작성 페이지로 이동합니다.');">리뷰하기</button>
    </div> -->
  </main>

  <footer>
    <p><strong>Project A P M</strong></p>
    <p>대표자 채희수</p>
    <p>이메일 dooly123@naver.com</p>
    <p>연락처 010 1234 5678</p>
  </footer>

  <script>
    const reviewListElement = document.getElementById('reviewList');
    const searchInput = document.getElementById('searchInput');

    // 프로필 및 인증 처리
    const profile = document.getElementById("profile");
    const dropdown = document.getElementById("dropdown");
    const authArea = document.getElementById("authArea");

    profile.addEventListener("click", () => {
      dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
    });

    function logout() {
      localStorage.removeItem("currentUser");
      location.reload();
    }

    window.onload = () => {
      const currentUser = localStorage.getItem("currentUser");
      if (currentUser) {
        authArea.style.display = "none";
        profile.style.display = "flex";
        document.getElementById("avatar").innerText = currentUser.charAt(0).toUpperCase();
        document.getElementById("welcomeMsg").innerText = currentUser + "님 환영합니다!";
      }

      // 보호할 링크들
      const protectedLinks = [
        document.querySelector('a[href="../views/party/party-make01.html"]'),
        document.querySelector('a[href="../views/party/views/party/party-detail.html"]'),
        document.querySelector('a[href="../views/party/party-board.html"]'),
        document.querySelector('a[href="../views/party/payment.html"]'),
        document.querySelector('a[href="../views/advertisement/advertisement.html"]'),
        document.querySelector('a[href="../views/advertisement/listTest.html"]'),
        document.querySelector('a[href="../views/advertisement/advertisement_detail.html"]')
      ];

      protectedLinks.forEach(link => {
        if (link) {
          link.addEventListener("click", (e) => {
            if (!currentUser) {
              e.preventDefault(); // 기본 이동 막기
              alert("로그인이 필요합니다.");
              window.location.href = "../views/member/login.html"; // 로그인 페이지로 이동
            }
          });
        }
      });
    };

    window.addEventListener("click", (e) => {
      if (!profile.contains(e.target)) {
        dropdown.style.display = "none";
      }
    });

    // 리뷰 + 파티 목록 렌더링
    function renderReviews(filter = '') {
      reviewListElement.innerHTML = '';

      // 1. 로컬스토리지에 저장된 리뷰 불러오기
      const reviews = JSON.parse(localStorage.getItem('reviews')) || [];

      // 2. 최신순 리뷰 먼저 표시
      const filteredReviews = reviews
        .filter(r =>
          r.party.toLowerCase().includes(filter.toLowerCase()) ||
          r.content.toLowerCase().includes(filter.toLowerCase())
        )
        .sort((a, b) => b.timestamp - a.timestamp);

      filteredReviews.forEach(review => {
        const div = document.createElement('div');
        div.className = 'review-item';
        div.innerHTML = `
      <strong>${review.party}</strong><br>
      ${'⭐'.repeat(review.rating)} - ${review.content.substring(0, 50)}...
    `;
        div.onclick = () => {
          window.location.href = `./member/review_detail.html?party=${encodeURIComponent(review.party)}`;
        };
        reviewListElement.appendChild(div);
      });

      // 3. 기존 하드코딩 파티 목록은 아래쪽에 표시
      const parties = JSON.parse(localStorage.getItem('userParties')) || [
        { name: '파티 모집 예시 입니다 -  리뷰 예시' }
      ];

      parties
        .filter(party => party.name.toLowerCase().includes(filter.toLowerCase()))
        .forEach(party => {
          const div = document.createElement('div');
          div.className = 'review-item';
          div.textContent = party.name;
          div.onclick = () => {
            window.location.href = `./member/review_detail.html?party=${encodeURIComponent(party.name)}`;
          };
          reviewListElement.appendChild(div);
        });

      // 4. 아무것도 없을 경우 안내 문구
      if (reviewListElement.innerHTML.trim() === '') {
        reviewListElement.innerHTML = '<p style="text-align:center;color:gray;">등록된 리뷰가 없습니다.</p>';
      }
    }

    // 검색 이벤트
    searchInput.addEventListener('input', () => {
      renderReviews(searchInput.value);
    });

    // 초기 표시
    renderReviews();
  </script>
</body>

</html>